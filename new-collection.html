<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dream OS — New Collection</title>
  <link rel="stylesheet" href="dreamos.css">
  <link rel="stylesheet" href="./css/collections.css">
</head>

<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="orb"></div>
        <div class="brandText"><strong>Dream Agent Studio</strong><span>Create. Shape. Release.</span></div>

      </div>

      <nav class="nav" aria-label="Primary">
        <a href="dashboard.html"><span>Dashboard</span><small>⌘1</small></a>
        <a href="create.html"><span>Create</span><small>⌘2</small></a>
        <a class="active" href="collections.html"><span>Collections</span><small>⌘3</small></a>
        <a href="distribute.html"><span>Distribute</span><small>⌘4</small></a>
        <a href="socials.html"><span>Socials</span><small>⌘5</small></a>
        <a href="website.html"><span>Website</span><small>⌘6</small></a>
        <!-- <a href="#"><span>Settings</span><small>⌘7</small></a> -->
      </nav>

      <!-- ACCOUNT / PROFILE (sidebar footer) -->
      <div class="sidebar-footer account-footer">
        <button class="account-btn" id="accountBtn" type="button" aria-haspopup="menu" aria-expanded="false">
          <div class="account-avatar">
            <img src="./img/blue_user.png" class="user_avatar" alt="User Avatar" />
            <div class="account-meta">
              <p class="account-name">The Usersname</p>
              <p class="account-role">Artist</p>
            </div>
          </div>
          <small class="account-chev" aria-hidden="true">⌄</small>
        </button>

        <!-- Account menu -->
        <div class="account-menu" id="accountMenu" role="menu" aria-label="Account menu">
          <button class="menu-item" role="menuitem" type="button" data-go="profile.html">Profile Details</button>
          <button class="menu-item" role="menuitem" type="button" data-go="profile_settings.html">Profile Settings</button>
          <button class="menu-item" role="menuitem" type="button" data-go="display_settings.html">Display Settings</button>
          <div class="menu-sep" aria-hidden="true"></div>
          <button class="menu-item danger" role="menuitem" type="button" data-go="index.html">Logout</button>
        </div>
      </div>
    </aside>

    <!-- Scrim for mobile -->
    <div class="scrim" id="scrim" onclick="toggleSidebar(false)"></div>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <div class="topbar">
        <div class="topLeft">
          <button class="burger" id="burger" aria-label="Open menu" onclick="toggleSidebar()">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M5 7h14M5 12h14M5 17h14" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </button>

          <div class="crumbs">
            <div class="kicker">Collections</div>
            <div class="title">New Collection</div>
          </div>
        </div>

        <div class="topRight">
          <!-- <div class="pill">Build: v0.1</div> -->
          <button class="btn" type="button" onclick="window.location.href='collections.html'">View all</button>
        </div>
      </div>

      <div class="content">
        <section class="panel">
          <div class="head">
            <h2>Create a Collection</h2>
            <div class="pill">Non-destructive grouping</div>
          </div>

          <div class="body">
            <div class="collections-grid">
              <!-- LEFT: Form -->
              <div class="panel" style="background:transparent; border:0; box-shadow:none;">
                <div style="display:flex; flex-direction:column; gap:12px;">
                  <div class="field">
                    <div class="label">
                      Collection name
                      <span class="hint">Human-facing title</span>
                    </div>
                    <input id="colName" type="text" placeholder="War & Feast" />
                  </div>

                  <div class="two">
                    <div class="field">
                      <div class="label">
                        Slug
                        <span class="hint">URL-safe</span>
                      </div>
                      <input id="colSlug" type="text" placeholder="war-and-feast" />
                    </div>

                    <div class="field">
                      <div class="label">
                        Visibility
                        <span class="hint">Default</span>
                      </div>
                      <select id="colVisibility">
                        <option value="private">Private</option>
                        <option value="unlisted">Unlisted</option>
                        <option value="public" selected>Public</option>
                      </select>
                    </div>
                  </div>

                  <div class="field">
                    <div class="label">
                      Description
                      <span class="hint">Short, archive-ready</span>
                    </div>
                    <textarea id="colDesc" placeholder="A dossier of rituals, appetite, and power structures."></textarea>
                  </div>

                  <div class="field">
                    <div class="label">
                      Cover image
                      <span class="hint">Optional</span>
                    </div>

                    <div class="uploadRow">
                      <label class="fileBtn" for="coverFile">
                        <span class="dot" aria-hidden="true"></span>
                        Upload cover
                      </label>
                      <div class="fileMeta" id="fileMeta">No file selected</div>
                    </div>

                    <input id="coverFile" type="file" accept="image/*" />
                  </div>

                  <div class="formActions">
                    <button class="btn primary" type="button" onclick="saveCollection()">
                      <span class="dot"></span>Create Collection
                    </button>
                    <button class="btn" type="button" onclick="resetForm()">Reset</button>
                  </div>
                </div>
              </div>

              <!-- RIGHT: Preview + Existing -->
              <div>
                <div class="previewCard">
                  <div class="previewTop">
                    <div class="title">Live Preview</div>
                    <div class="badge" id="previewVis">public</div>
                  </div>

                  <div class="previewBody">
                    <div class="coverMock" id="coverMock">
                      <div class="ghost">
                        <span id="previewSlug">war-and-feast</span>
                        <span>cover</span>
                      </div>
                    </div>

                    <div class="previewMeta">
                      <div class="name" id="previewName">War &amp; Feast</div>
                      <div class="desc" id="previewDesc">
                        A dossier of rituals, appetite, and power structures.
                      </div>
                    </div>
                  </div>
                </div>

                <div class="stack">
                  <div class="pill" style="width:fit-content;">Existing</div>

                  <div class="item">
                    <div class="itemLeft">
                      <div class="itemName">Signals &amp; Ascensions</div>
                      <div class="itemSlug">signals-and-ascensions</div>
                    </div>
                    <div class="itemRight">
                      <div class="badge">public</div>
                      <button class="iconBtn" type="button" onclick="alert('Open collection');" aria-label="Open">
                        <svg viewBox="0 0 24 24" fill="none">
                          <path d="M9 18l6-6-6-6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                    </div>
                  </div>

                  <div class="item">
                    <div class="itemLeft">
                      <div class="itemName">Industrial Scriptures</div>
                      <div class="itemSlug">industrial-scriptures</div>
                    </div>
                    <div class="itemRight">
                      <div class="badge">unlisted</div>
                      <button class="iconBtn" type="button" onclick="alert('Open collection');" aria-label="Open">
                        <svg viewBox="0 0 24 24" fill="none">
                          <path d="M9 18l6-6-6-6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                    </div>
                  </div>

                  <div class="item">
                    <div class="itemLeft">
                      <div class="itemName">The Digital Unconscious</div>
                      <div class="itemSlug">digital-unconscious</div>
                    </div>
                    <div class="itemRight">
                      <div class="badge">private</div>
                      <button class="iconBtn" type="button" onclick="alert('Open collection');" aria-label="Open">
                        <svg viewBox="0 0 24 24" fill="none">
                          <path d="M9 18l6-6-6-6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    // Sidebar toggle (matches your burger/scrim pattern)
    function toggleSidebar(force){
      const sidebar = document.getElementById('sidebar');
      const scrim = document.getElementById('scrim');
      const burger = document.getElementById('burger');

      const willOpen = (typeof force === 'boolean') ? force : !sidebar.classList.contains('open');

      sidebar.classList.toggle('open', willOpen);
      scrim.classList.toggle('show', willOpen);
      burger.classList.toggle('active', willOpen);
    }

    // Live preview wiring
    const nameEl = document.getElementById('colName');
    const slugEl = document.getElementById('colSlug');
    const descEl = document.getElementById('colDesc');
    const visEl  = document.getElementById('colVisibility');
    const fileEl = document.getElementById('coverFile');

    const pName = document.getElementById('previewName');
    const pSlug = document.getElementById('previewSlug');
    const pDesc = document.getElementById('previewDesc');
    const pVis  = document.getElementById('previewVis');
    const fileMeta = document.getElementById('fileMeta');
    const coverMock = document.getElementById('coverMock');

    function slugify(v){
      return (v || '')
        .toLowerCase()
        .trim()
        .replace(/['"]/g,'')
        .replace(/\s+/g,'-')
        .replace(/[^a-z0-9\-]/g,'')
        .replace(/\-+/g,'-');
    }

    function syncPreview(){
      const name = nameEl.value.trim() || 'War & Feast';
      const slug = slugEl.value.trim() || slugify(name) || 'war-and-feast';
      const desc = descEl.value.trim() || 'A dossier of rituals, appetite, and power structures.';
      const vis  = visEl.value;

      pName.textContent = name;
      pSlug.textContent = slug;
      pDesc.textContent = desc;
      pVis.textContent = vis;
    }

    nameEl.addEventListener('input', () => {
      // auto-fill slug only if user hasn't touched slug much
      if (!slugEl.dataset.touched){
        slugEl.value = slugify(nameEl.value);
      }
      syncPreview();
    });

    slugEl.addEventListener('input', () => {
      slugEl.dataset.touched = "1";
      syncPreview();
    });

    descEl.addEventListener('input', syncPreview);
    visEl.addEventListener('change', syncPreview);

    fileEl.addEventListener('change', () => {
      const f = fileEl.files && fileEl.files[0];
      if (!f){
        fileMeta.textContent = 'No file selected';
        coverMock.style.backgroundImage = '';
        syncPreview();
        return;
      }
      fileMeta.textContent = f.name;

      // tiny preview: set as background image (non-destructive, only UI)
      const url = URL.createObjectURL(f);
      coverMock.style.background = `
        radial-gradient(650px 220px at 30% 20%, rgba(180,207,106,0.08), transparent 60%),
        radial-gradient(520px 240px at 85% 30%, rgba(120,90,255,0.10), transparent 60%),
        url(${url}) center/cover no-repeat
      `;
      syncPreview();
    });

    function resetForm(){
      nameEl.value = '';
      slugEl.value = '';
      delete slugEl.dataset.touched;
      descEl.value = '';
      visEl.value = 'public';
      fileEl.value = '';
      fileMeta.textContent = 'No file selected';
      coverMock.style.background = `
        radial-gradient(650px 220px at 30% 20%, rgba(180,207,106,0.10), transparent 60%),
        radial-gradient(520px 240px at 85% 30%, rgba(120,90,255,0.14), transparent 60%),
        rgba(255,255,255,0.02)
      `;
      syncPreview();
    }

    function saveCollection(){
      // Hook this to your backend later
      const payload = {
        name: nameEl.value.trim(),
        slug: slugEl.value.trim(),
        description: descEl.value.trim(),
        visibility: visEl.value,
      };
      alert('Hook to POST /api/collections\n\n' + JSON.stringify(payload, null, 2));
    }

    // initial preview
    syncPreview();
  </script>

  <script src="profile-menu.js"></script>
</body>
</html>
