<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dream OS — Distribute</title>
  <link rel="stylesheet" href="dreamos.css">
  <link rel="stylesheet" href="./css/distribute.css">
</head>

<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="orb"></div>
        <div class="brandText"><strong>Dream Agent Studio</strong><span>Create. Shape. Release.</span></div>

      </div>

      <nav class="nav" aria-label="Primary">
        <a href="dashboard.html"><span>Dashboard</span><small>⌘1</small></a>
        <a href="create.html"><span>Create</span><small>⌘2</small></a>
        <a href="collections.html"><span>Collections</span><small>⌘3</small></a>
        <a class="active" href="distribute.html"><span>Distribute</span><small>⌘4</small></a>
        <a href="socials.html">Socials <small>⌘5</small></a>
        <a href="website.html">Website <small>⌘6</small></a>
        <!-- <a href="#">Settings <small>⌘7</small></a> -->
      </nav>

      <!-- ACCOUNT / PROFILE (sidebar footer) -->
      <div class="sidebar-footer account-footer">
        <button class="account-btn" id="accountBtn" type="button" aria-haspopup="menu" aria-expanded="false">
          <div class="account-avatar">
            <img src="./img/blue_user.png" class="user_avatar" alt="User Avatar" />
            <div class="account-meta">
              <p class="account-name">The Usersname</p>
              <p class="account-role">Artist</p>
            </div>
          </div>
          <small class="account-chev" aria-hidden="true">⌄</small>
        </button>

        <!-- Account menu -->
        <div class="account-menu" id="accountMenu" role="menu" aria-label="Account menu">
          <button class="menu-item" role="menuitem" type="button" data-go="profile.html">Profile Details</button>
          <button class="menu-item" role="menuitem" type="button" data-go="profile_settings.html">Profile Settings</button>
          <button class="menu-item" role="menuitem" type="button" data-go="display_settings.html">Display Settings</button>
          <div class="menu-sep" aria-hidden="true"></div>
          <button class="menu-item danger" role="menuitem" type="button" data-go="index.html">Logout</button>
        </div>
      </div>
    </aside>

    <!-- Scrim for mobile -->
    <div class="scrim" id="scrim" onclick="toggleSidebar(false)"></div>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <div class="topbar">
        <div class="topLeft">
          <button class="burger" id="burger" aria-label="Open menu" onclick="toggleSidebar()">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M5 7h14M5 12h14M5 17h14" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </button>

          <div class="crumbs">
            <div class="kicker">Distribution</div>
            <div class="title">Connect · Mint · Publish</div>
          </div>
        </div>

        <div class="topRight">
          <!-- <div class="pill">Build: v0.1</div> -->
          <button class="btn primary" type="button" onclick="alert('Hook: open mint queue');">
            <span class="dot"></span>Queue
          </button>
        </div>
      </div>

      <div class="content">

        <!-- CONNECTORS -->
        <section class="panel">
          <div class="head">
            <h2>Marketplaces</h2>
            <div class="pill">Connect once, ship everywhere</div>
          </div>

          <div class="body">
            <div class="connectors">

              <!-- XRP Cafe -->
              <div class="connector" data-market="xrpcafe">
                <div class="cTop">
                  <div class="cBrand">
                    <div class="cIcon" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none">
                        <path d="M7 7h10M7 12h10M7 17h10" stroke-width="1.8" stroke-linecap="round"/>
                      </svg>
                    </div>
                    <div class="cName">
                      <strong>XRP Café</strong>
                      <span>XRPL mint + listings</span>
                    </div>
                  </div>
                  <div class="statusPill on" id="st-xrpcafe">connected</div>
                </div>
                <div class="cBody">Primary rail for Dream Agent drops. Supports collections and editions.</div>
                <div class="cActions">
                  <button class="btn" type="button" onclick="disconnect('xrpcafe')">Disconnect</button>
                  <button class="btn primary" type="button" onclick="manage('xrpcafe')"><span class="dot"></span>Manage</button>
                </div>
              </div>

              <!-- OpenSea -->
              <div class="connector" data-market="opensea">
                <div class="cTop">
                  <div class="cBrand">
                    <div class="cIcon" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none">
                        <path d="M12 3l7 7-7 11-7-11 7-7Z" stroke-width="1.8" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="cName">
                      <strong>OpenSea</strong>
                      <span>Ethereum / Polygon</span>
                    </div>
                  </div>
                  <div class="statusPill" id="st-opensea">not connected</div>
                </div>
                <div class="cBody">Connect a wallet to publish on EVM chains with optional royalties.</div>
                <div class="cActions">
                  <button class="btn primary" type="button" onclick="connect('opensea')"><span class="dot"></span>Connect</button>
                  <button class="btn" type="button" onclick="alert('Docs link placeholder');">Docs</button>
                </div>
              </div>

              <!-- Manifold -->
              <div class="connector" data-market="manifold">
                <div class="cTop">
                  <div class="cBrand">
                    <div class="cIcon" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none">
                        <path d="M6 18V6l6 6 6-6v12" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="cName">
                      <strong>Manifold</strong>
                      <span>Contract-based drops</span>
                    </div>
                  </div>
                  <div class="statusPill soon" id="st-manifold">coming soon</div>
                </div>
                <div class="cBody">For custom contracts, claim pages, and drop mechanics. (Stub UI)</div>
                <div class="cActions">
                  <button class="btn" type="button" onclick="alert('Coming soon');">Notify</button>
                  <button class="btn" type="button" onclick="alert('Coming soon');">Learn</button>
                </div>
              </div>

              <!-- SuperRare -->
              <div class="connector" data-market="superrare">
                <div class="cTop">
                  <div class="cBrand">
                    <div class="cIcon" aria-hidden="true">
                      <svg viewBox="0 0 24 24" fill="none">
                        <path d="M12 21s-7-4.5-7-11a4 4 0 0 1 7-2 4 4 0 0 1 7 2c0 6.5-7 11-7 11Z" stroke-width="1.8" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="cName">
                      <strong>SuperRare</strong>
                      <span>1/1 curation</span>
                    </div>
                  </div>
                  <div class="statusPill soon" id="st-superrare">coming soon</div>
                </div>
                <div class="cBody">Curation-first pipeline. Keep drafts here until approved.</div>
                <div class="cActions">
                  <button class="btn" type="button" onclick="alert('Coming soon');">Notify</button>
                  <button class="btn" type="button" onclick="alert('Coming soon');">Learn</button>
                </div>
              </div>

            </div>
          </div>
        </section>

        <!-- MINT + QUEUE -->
        <div class="dist-grid">

          <!-- LEFT: Mint / Publish form -->
          <section class="panel">
            <div class="head">
              <h2>Mint / Publish</h2>
              <div class="pill">Draft → chain → listing</div>
            </div>

            <div class="body" style="display:flex; flex-direction:column; gap:12px;">
              <div class="field">
            <div class="label">Image <span class="hint">Source asset</span></div>

            <!-- Later: this becomes "Open Library" -->
            <div class="two">
                <button class="btn" type="button" id="chooseImageBtn" onclick="chooseImage()">
                Choose image
                </button>

                <div class="pill" id="imageState">none selected</div>
            </div>

            <!-- Optional tiny preview row -->
            <div id="imagePreviewRow" style="display:none; gap:10px; align-items:center;">
                <img id="imageThumb" alt="" style="width:46px;height:46px;border-radius:14px;object-fit:cover;border:1px solid rgba(255,255,255,0.10);" />
                <div style="min-width:0;">
                <div style="font-weight:950;color:var(--text-2);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" id="imageName">—</div>
                <div style="font-family:var(--mono);font-size:11px;color:rgba(255,255,255,0.45);" id="imageMeta">—</div>
                </div>
            </div>
            </div>

            <div class="field">
            <div class="label">
                Title
                <span class="hint">
                <button type="button" class="linkLike" onclick="openTitleSuggestions()">Need title ideas?</button>
                </span>
            </div>
            <input id="title" type="text" placeholder="Enter title..." />
            </div>


              <div class="two">
                <div class="field">
                  <div class="label">Collection <span class="hint">Optional</span></div>
                  <select id="collection">
                    <option value="">None</option>
                    <option>War & Feast</option>
                    <option>Signals & Ascensions</option>
                    <option>Industrial Scriptures</option>
                  </select>
                </div>
                <div class="field">
                  <div class="label">Marketplace <span class="hint">Connected only</span></div>
                  <select id="market">
                    <option value="xrpcafe">XRP Café (XRPL)</option>
                    <option value="opensea">OpenSea (EVM)</option>
                  </select>
                </div>
              </div>

              <div class="two">
                <div class="field">
                  <div class="label">Edition size <span class="hint">1 = one-of-one</span></div>
                  <input id="edition" type="number" min="1" value="1" />
                </div>
                <div class="field">
                  <div class="label">Royalties % <span class="hint">EVM dependent</span></div>
                  <input id="royalties" type="number" min="0" max="25" step="0.5" value="10" />
                </div>
              </div>

              <div class="two">
                <div class="field">
                  <div class="label">Price <span class="hint">Listing</span></div>
                  <input id="price" type="text" placeholder="e.g. 125 XRP or 0.08 ETH" />
                </div>
                <div class="field">
                  <div class="label">Sale type <span class="hint">Default</span></div>
                  <select id="saleType">
                    <option value="fixed" selected>Fixed</option>
                    <option value="auction">Auction</option>
                    <option value="open">Open edition window</option>
                  </select>
                </div>
              </div>

              <div class="field">
                <div class="label">Description <span class="hint">Public listing</span></div>
                <textarea
                    id="description"
                    placeholder="Public description shown on the marketplace listing..."
                ></textarea>
                </div>


              <div class="mintActions">
                <button class="btn primary" type="button" onclick="queueMint()">
                  <span class="dot"></span>Add to Queue
                </button>
                <button class="btn" type="button" onclick="dryRun()">Dry run</button>
              </div>
            </div>
          </section>

          <!-- RIGHT: Queue / activity -->
          <section class="panel">
            <div class="head">
              <h2>Queue</h2>
              <div class="pill">Live ops</div>
            </div>

            <div class="body">
              <div class="queue" id="queue">
                <div class="qItem" data-title="The Soap Wars"
                        data-meta="xrpcafe · edition 1 · fixed · 125 XRP"
                        data-status="ready"
                        data-market="xrpcafe"
                        data-chain="XRPL"
                        data-edition="1"
                        data-royalties="10%"
                        data-price="125 XRP"
                        data-notes="Collector text locked. Cover verified. Ready to mint.">
                  <div class="qLeft">
                    <div class="qTitle">The Soap Wars</div>
                    <div class="qMeta">xrpcafe · edition 1 · fixed · 125 XRP</div>
                  </div>
                  <div class="qRight">
                    <div class="statusPill on">ready</div>
                    <button class="iconBtn" type="button" onclick="openMintModal(this)" aria-label="Open">
                      <svg viewBox="0 0 24 24" fill="none">
                        <path d="M9 18l6-6-6-6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </div>

                <div class="qItem"
                                data-title="Dream Agent Distilleries"
                                data-meta="opensea · edition 1 · fixed · 0.08 ETH"
                                data-status="draft"
                                data-market="opensea"
                                data-chain="Ethereum"
                                data-edition="1"
                                data-royalties="10%"
                                data-price="0.08 ETH"
                                data-notes="Initial draft. Needs review before mint.">
                  <div class="qLeft">
                    <div class="qTitle">Dream Agent Distilleries</div>
                    <div class="qMeta">opensea · edition 1 · fixed · 0.08 ETH</div>
                  </div>
                  <div class="qRight">
                    <div class="statusPill">draft</div>
                    <button class="iconBtn" type="button" onclick="openMintModal(this)" aria-label="Open">
                      <svg viewBox="0 0 24 24" fill="none">
                        <path d="M9 18l6-6-6-6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </div>

                <div class="qItem" data-title="Temple of Openings"
                                data-meta="xrpcafe · edition 1 · fixed · 150 XRP"
                                data-status="pending"
                                data-market="xrpcafe"
                                data-chain="XRPL"
                                data-edition="1"
                                data-royalties="10%"
                                data-price="125 XRP"
                                data-notes="Collector text locked. Cover verified. Ready to mint.">
                  <div class="qLeft">
                    <div class="qTitle">Temple of Openings</div>
                    <div class="qMeta">xrpcafe · edition 10 · open edition</div>
                  </div>
                  <div class="qRight">
                    <div class="statusPill soon">pending</div>
                    <button class="iconBtn" type="button" onclick="openMintModal(this)" aria-label="Open">
                      <svg viewBox="0 0 24 24" fill="none">
                        <path d="M9 18l6-6-6-6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </div>

              </div>
            </div>
          </section>

        </div>
      </div>
    </main>
  </div>

    <!-- Mint Details Modal / Drawer -->
    <div class="modal" id="mintModal" aria-hidden="true">
    <div class="modalScrim" onclick="closeMintModal()"></div>

    <div class="modalCard" role="dialog" aria-modal="true" aria-label="Mint details">
        <div class="modalHead">
        <div class="modalTitleWrap">
            <div class="modalKicker">Mint details</div>
            <div class="modalTitle" id="mTitle">—</div>
            <div class="modalMeta" id="mMeta">—</div>
        </div>

        <button class="iconBtn" type="button" onclick="closeMintModal()" aria-label="Close">
            <svg viewBox="0 0 24 24" fill="none">
            <path d="M6 6l12 12M18 6L6 18" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
        </button>
        </div>

        <div class="modalBody">
        <div class="modalGrid">
            <!-- <div class="mBox"><div class="mK">Status</div><div class="mV" id="mStatus">—</div></div> -->
            <div class="mBox" id="mStatusBox">
                <div class="mK">Status</div>
                <div class="mV statusText" id="mStatus">—</div>
            </div>

            <div class="mBox"><div class="mK">Marketplace</div><div class="mV" id="mMarket">—</div></div>
            <div class="mBox"><div class="mK">Chain</div><div class="mV" id="mChain">—</div></div>
            <div class="mBox"><div class="mK">Edition</div><div class="mV" id="mEdition">—</div></div>
            <div class="mBox"><div class="mK">Royalties</div><div class="mV" id="mRoyalties">—</div></div>
            <div class="mBox"><div class="mK">Price</div><div class="mV" id="mPrice">—</div></div>
        </div>

        <div class="mNotes">
            <div class="mK">Description</div>
            <div class="mNoteText" id="mDescription">—</div>
        </div>


        <div class="modalActions">
            <button class="btn primary" type="button" onclick="alert('Hook: run mint');">
            <span class="dot"></span>Run mint
            </button>
            <button class="btn" type="button" onclick="alert('Hook: edit queued item');">Edit</button>
            <button class="btn" type="button" onclick="alert('Hook: remove from queue');">Remove</button>
        </div>
        </div>
    </div>
    </div>


    <script>
        // Sidebar toggle (matches your burger/scrim pattern)
        function toggleSidebar(force){
        const sidebar = document.getElementById('sidebar');
        const scrim = document.getElementById('scrim');
        const burger = document.getElementById('burger');

        const willOpen = (typeof force === 'boolean') ? force : !sidebar.classList.contains('open');

        sidebar.classList.toggle('open', willOpen);
        scrim.classList.toggle('show', willOpen);
        burger.classList.toggle('active', willOpen);
        }

        // Connector stubs
        function connect(m){
        document.getElementById('st-' + m).textContent = 'connected';
        document.getElementById('st-' + m).classList.add('on');
        alert('Hook: OAuth / wallet connect for ' + m);
        }
        function disconnect(m){
        document.getElementById('st-' + m).textContent = 'not connected';
        document.getElementById('st-' + m).classList.remove('on');
        alert('Hook: revoke token for ' + m);
        }
        function manage(m){
        alert('Hook: manage connection settings for ' + m);
        }

        // Mint stubs
        function dryRun(){
        const payload = readForm();
        alert('Dry run (no mint)\n\n' + JSON.stringify(payload, null, 2));
        }

        function queueMint(){
        const payload = readForm();
        addQueueItem(payload);
        alert('Hook: POST /api/mint/queue\n\n' + JSON.stringify(payload, null, 2));
        }

        function readForm(){
            return {
                artwork: document.getElementById('artwork').value,
                collection: document.getElementById('collection').value || null,
                marketplace: document.getElementById('market').value,
                edition: document.getElementById('edition').value,
                royalties: document.getElementById('royalties').value,
                price: document.getElementById('price').value,
                saleType: document.getElementById('saleType').value,
                description: document.getElementById('description').value
            };
        }

        function chainFor(market){
    if (market === 'xrpcafe') return 'XRPL';
    if (market === 'opensea') return 'EVM';
    return '—';
    }

    function addQueueItem(p){
    const queue = document.getElementById('queue');

    const cleanTitle = (p.artwork || '—').replace(/\s*\(Draft\)\s*/i,'').trim();
    const meta = `${p.marketplace} · edition ${p.edition} · ${p.saleType} · ${p.price || '—'}`;

    const item = document.createElement('div');
    item.className = 'qItem';

    // Store details for modal
    item.dataset.title = cleanTitle;
    item.dataset.meta = meta;
    item.dataset.status = 'draft';
    item.dataset.market = p.marketplace;
    item.dataset.chain = chainFor(p.marketplace);
    item.dataset.edition = String(p.edition || '—');
    item.dataset.royalties = (p.royalties !== '' ? `${p.royalties}%` : '—');
    item.dataset.price = p.price || '—';
    item.dataset.description = p.description || '—';

    item.innerHTML = `
        <div class="qLeft">
        <div class="qTitle">${escapeHtml(cleanTitle)}</div>
        <div class="qMeta">${escapeHtml(meta)}</div>
        </div>
        <div class="qRight">
        <div class="statusPill">draft</div>
        <button class="iconBtn" type="button" onclick="openMintModal(this)" aria-label="Open mint details">
            <svg viewBox="0 0 24 24" fill="none">
            <path d="M9 18l6-6-6-6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        </div>
    `;

    queue.prepend(item);
    }


    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }

    function openMintModal(btn){
        const item = btn.closest('.qItem');
        if (!item) return;

        // Prefer dataset (you already set it). Fallback to visible text.
        const title = item.dataset.title || item.querySelector('.qTitle')?.textContent?.trim() || '—';
        const meta  = item.dataset.meta  || item.querySelector('.qMeta')?.textContent?.trim()  || '—';

        document.getElementById('mTitle').textContent = title;
        document.getElementById('mMeta').textContent  = meta;

        // Fill detail fields
        document.getElementById('mMarket').textContent    = item.dataset.market || '—';
        document.getElementById('mChain').textContent     = item.dataset.chain || '—';
        document.getElementById('mEdition').textContent   = item.dataset.edition || '—';
        document.getElementById('mRoyalties').textContent = item.dataset.royalties || '—';
        document.getElementById('mPrice').textContent     = item.dataset.price || '—';
        document.getElementById('mDescription').textContent =item.dataset.description || '—';


        // ✅ Status text + status-only color
        const statusEl = document.getElementById('mStatus');
        const status = (item.dataset.status || '').toLowerCase();

        statusEl.textContent = status || '—';
        statusEl.classList.remove('ready','pending','draft');
        if (status) statusEl.classList.add(status);

        // ✅ make ONLY the status box green-outlined when ready
        const statusBox = document.getElementById('mStatusBox');
        statusBox.classList.toggle('is-ready', status === 'ready');


        // Open modal
        const modal = document.getElementById('mintModal');
        modal.classList.add('show');
        modal.setAttribute('aria-hidden','false');
        document.body.style.overflow = 'hidden';
    }



function closeMintModal(){
  const modal = document.getElementById('mintModal');
  modal.classList.remove('show');
  modal.setAttribute('aria-hidden','true');
  document.body.style.overflow = '';
}

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closeMintModal();
});


  </script>

  <script src="profile-menu.js"></script>
</body>
</html>
